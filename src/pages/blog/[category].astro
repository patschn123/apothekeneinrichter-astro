---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const allBlogPosts = await getCollection('blog', ({ data }) => {
    return !data.draft;
  });

  const categories = [...new Set(allBlogPosts.map(post => post.data.category))];

  return categories.map(category => ({
    params: { category },
    props: {
      posts: allBlogPosts
        .filter(post => post.data.category === category)
        .sort((a, b) =>
          new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
        )
    }
  }));
}

const { category } = Astro.params;
const { posts } = Astro.props;

const categoryNames = {
  'apothekenplanung': 'Apothekenplanung',
  'praxiseinrichtung': 'Praxiseinrichtung',
  'einrichtungstrends': 'Einrichtungstrends',
  'betriebsoptimierung': 'Betriebsoptimierung',
  'renovierung-modernisierung': 'Renovierung & Modernisierung'
};

const categoryName = categoryNames[category] || category;

const seoProps = {
  title: `${categoryName} - Expertentipps von Rebekka Mädler | Mädler`,
  description: `Entdecken Sie Rebekka Mädlers Expertentipps zu ${categoryName}. Praktische Ratschläge für Apothekeneinrichtung und Praxisdesign.`,
  canonical: `https://www.apothekeneinrichter.de/blog/${category}`
};

// Breadcrumb data
const breadcrumbs = [
  { name: 'Home', href: '/' },
  { name: 'Blog', href: '/blog' },
  { name: categoryName, href: `/blog/${category}` }
];
---

<BaseLayout {...seoProps}>
  <Header />

  <main class="section bg-background">
    <div class="container">
    <!-- Breadcrumbs -->
    <nav class="mb-8">
      <ol class="flex items-center space-x-2 text-sm text-gray-500">
        {breadcrumbs.map((item, index) => (
          <li class="flex items-center">
            {index > 0 && <span class="mx-2">/</span>}
            {index === breadcrumbs.length - 1 ? (
              <span class="text-gray-900 font-medium">{item.name}</span>
            ) : (
              <a href={item.href} class="hover:text-primary transition-colors">
                {item.name}
              </a>
            )}
          </li>
        ))}
      </ol>
    </nav>

    <!-- Header -->
    <header class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        {categoryName}
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Expertenratgeber von Rebekka Mädler zu {categoryName.toLowerCase()}.
        Praktische Tipps aus 15 Jahren Erfahrung in der Apothekeneinrichtung.
      </p>
    </header>

    <!-- Back to all posts -->
    <div class="mb-8">
      <a
        href="/blog"
        class="inline-flex items-center text-blue-600 hover:text-blue-700 transition-colors"
      >
        ← Alle Blog-Artikel anzeigen
      </a>
    </div>

    <!-- Blog Posts Grid -->
    <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {posts.map(post => (
        <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
          <img
            src={post.data.featuredImage}
            alt={post.data.title}
            class="w-full h-48 object-cover"
          />
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <time class="text-sm text-gray-500">
                {new Date(post.data.publishDate).toLocaleDateString('de-DE')}
              </time>
            </div>
            <h2 class="text-xl font-bold text-primary mb-3 line-clamp-2">
              <a href={`/blog/${post.data.category}/${post.slug.replace(post.data.category + '/', '')}`} class="hover:text-primary-light transition-colors">
                {post.data.title}
              </a>
            </h2>
            <p class="text-secondary mb-4 line-clamp-3">
              {post.data.description}
            </p>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">von {post.data.author}</span>
              <a
                href={`/blog/${post.data.category}/${post.slug.replace(post.data.category + '/', '')}`}
                class="text-primary hover:text-primary-light font-medium text-sm"
              >
                Weiterlesen →
              </a>
            </div>
          </div>
        </article>
      ))}
    </section>

    <!-- Related Categories -->
    <section class="mt-16">
      <h3 class="text-2xl font-bold text-primary mb-6">Weitere Kategorien entdecken</h3>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        {Object.entries(categoryNames)
          .filter(([key]) => key !== category)
          .map(([key, name]) => (
            <a
              href={`/blog/${key}`}
              class="card hover:shadow-lg transition-all"
            >
              <h4 class="font-medium text-primary mb-2">{name}</h4>
              <p class="text-sm text-secondary">
                Expertentipps und Ratgeber
              </p>
            </a>
          ))
        }
      </div>
    </section>
    </div>
  </main>

  <Footer />
</BaseLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
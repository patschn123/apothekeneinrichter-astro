---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const allBlogPosts = await getCollection('blog', ({ data }) => {
  return !data.draft;
});

// Sort posts by publish date (newest first)
const sortedPosts = allBlogPosts.sort((a, b) =>
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);

// Get unique categories
const categories = [...new Set(allBlogPosts.map(post => post.data.category))];

const seoProps = {
  title: "Blog - Expertenratgeber für Apothekeneinrichtung | Mädler",
  description: "Entdecken Sie Rebekka Mädlers Expertentipps für Apothekeneinrichtung, Praxisdesign und Modernisierung. Über 140 Jahre Erfahrung in der Einrichtungsbranche.",
  canonical: "https://www.apothekeneinrichter.de/blog"
};
---

<BaseLayout {...seoProps}>
  <Header />

  <main class="section bg-background">
    <div class="container">
    <!-- Header -->
    <header class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">
        Expertenratgeber für Apothekeneinrichtung
      </h1>
      <p class="text-xl text-secondary max-w-3xl mx-auto">
        Rebekka Mädler teilt ihre 15-jährige Erfahrung in der Apothekeneinrichtung und gibt wertvolle Tipps für moderne, funktionale Gesundheitsräume.
      </p>
    </header>

    <!-- Categories Filter -->
    <section class="mb-12">
      <div class="flex flex-wrap gap-4 justify-center">
        <a href="/blog" class="btn btn-primary">
          Alle Artikel
        </a>
        {categories.map(category => (
          <a
            href={`/blog/${category}`}
            class="btn btn-secondary capitalize"
          >
            {category.replace('-', ' ')}
          </a>
        ))}
      </div>
    </section>

    <!-- Blog Posts Grid -->
    <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedPosts.map(post => (
        <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
          <img
            src={post.data.featuredImage}
            alt={post.data.title}
            class="w-full h-48 object-cover"
          />
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-sm text-primary font-medium capitalize">
                {post.data.category.replace('-', ' ')}
              </span>
              <span class="text-gray-400">•</span>
              <time class="text-sm text-gray-500">
                {new Date(post.data.publishDate).toLocaleDateString('de-DE')}
              </time>
            </div>
            <h2 class="text-xl font-bold text-primary mb-3 line-clamp-2">
              <a href={`/blog/${post.data.category}/${post.slug.replace(post.data.category + '/', '')}`} class="hover:text-primary-light transition-colors">
                {post.data.title}
              </a>
            </h2>
            <p class="text-secondary mb-4 line-clamp-3">
              {post.data.description}
            </p>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">von {post.data.author}</span>
              <a
                href={`/blog/${post.data.category}/${post.slug.replace(post.data.category + '/', '')}`}
                class="text-primary hover:text-primary-light font-medium text-sm"
              >
                Weiterlesen →
              </a>
            </div>
          </div>
        </article>
      ))}
    </section>

    <!-- Author Bio -->
    <section class="mt-16 bg-gray-50 rounded-lg p-8">
      <div class="flex flex-col md:flex-row items-center gap-6">
        <img
          src="/images/team/rebekka-maedler.jpg"
          alt="Rebekka Mädler"
          class="w-32 h-32 rounded-full object-cover"
        />
        <div>
          <h3 class="text-2xl font-bold text-primary mb-2">Rebekka Mädler</h3>
          <p class="text-secondary mb-4">
            Als Expertin für Apothekeneinrichtung in dritter Generation bringe ich über 15 Jahre Erfahrung in der Gestaltung funktionaler und ästhetischer Gesundheitsräume mit. Bei Mädler Einrichtungen liegt mir besonders die individuelle Beratung unserer Kunden am Herzen.
          </p>
          <a
            href="/unternehmen"
            class="inline-flex items-center text-primary hover:text-primary-light font-medium"
          >
            Mehr über unser Team erfahren →
          </a>
        </div>
      </div>
    </section>
    </div>
  </main>

  <Footer />
</BaseLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>